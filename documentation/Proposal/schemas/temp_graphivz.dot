digraph "dil_db" {

    graph [splines = ortho, ranksep=1.5];
    node [shape = record, style = filled, colorscheme = set312];
    edge [colorscheme = paired12, dir = both];

    # Entités principales
    addresses [label="{ Address | label : varchar\l city_label : varchar\l city_id : integer\l created_at : datetime\l updated_at : datetime\l last_editor : varchar\l _id_dil : varchar(25)\l }", fillcolor = 1];
    cities [label="{ City | label : varchar\l country_iso_code : varchar(2)\l long_lat : varchar\l insee_fr_code : varchar\l geoname_id : varchar\l wikidata_item_id : varchar\l created_at : datetime\l updated_at : datetime\l last_editor : varchar\l _id_dil : varchar(25)\l }", fillcolor = 2];
    images [label="{ Image | label : varchar\l reference_url : varchar\l iiif_url : varchar\l created_at : datetime\l updated_at : datetime\l last_editor : varchar\l _id_dil : varchar(25)\l }", fillcolor = 3];
    patents [label="{ Patent | drupal_nid : integer\l person_id : integer\l city_id : integer\l date_start : varchar\l date_end : varchar\l created_at : datetime\l updated_at : datetime\l last_editor : varchar\l _id_dil : varchar(25)\l }", fillcolor = 4];
    persons [label="{ Person | lastname : varchar\l firstnames : varchar\l birth_date : varchar\l birth_city_id : integer\l created_at : datetime\l updated_at : datetime\l last_editor : varchar\l _id_dil : varchar(25)\l }", fillcolor = 5];

    # Nœuds invisibles pour espacement vertical
    spacer1 [shape=point, width=0, height=0, style=invis];
    spacer2 [shape=point, width=0, height=0, style=invis];

    # Relations
    patent_has_addresses [label="{ Patent_has_addresses | patent_id : integer\l address_id : integer\l date_occupation : varchar\l }", fillcolor = 6];
    patent_has_images [label="{ Patent_has_images | patent_id : integer\l image_id : integer\l is_pinned : boolean\l }", fillcolor = 7];
    patent_has_relations [label="{ Patent_has_relations | patent_id : integer\l person_id : integer\l person_related_id : integer\l type : varchar(11)\l }", fillcolor = 8];
    person_has_addresses [label="{ Person_has_addresses | person_id : integer\l address_id : integer\l date_occupation : varchar\l }", fillcolor = 9];

    # Relations entre tables
    addresses -> cities [label="city_id → id", color=4];
    patent_has_addresses -> addresses [label="address_id → id", color=6];
    patent_has_addresses -> patents [label="patent_id → id", color=6];
    patent_has_images -> images [label="image_id → id", color=7];
    patent_has_images -> patents [label="patent_id → id", color=7];
    patent_has_relations -> patents [label="patent_id → id", color=8];
    patent_has_relations -> persons [label="person_id → id", color=8];
    patent_has_relations -> persons [label="person_related_id → id", color=8];
    patents -> cities [label="city_id → id", color=4];
    patents -> persons [label="person_id → id", color=4];
    person_has_addresses -> addresses [label="address_id → id", color=9];
    person_has_addresses -> persons [label="person_id → id", color=9];
    persons -> cities [label="birth_city_id → id", color=5];

    # Organisation des nœuds (hiérarchie visuelle)
    #{ rank = same; addresses; cities; images; patents; persons; }
    { rank = same; patent_has_images; patent_has_relations; }
    { rank = same; patent_has_addresses; person_has_addresses; }
}
